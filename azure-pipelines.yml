---
trigger:
- feature*

pool:
  vmImage: 'ubuntu-latest'

steps:

- checkout: self
  path: ansible-role-apache

- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.8'

- script: python -m pip install "molecule[lint]" "python-docker" "molecule-docker" "ansible"
  displayName: Install dependencies

- script: python -m pip install "python-tss-sdk"
  displayName: Role-specific dependencies

- script: |
    export PATH="$PATH:/home/<user>/.local/bin/"
    cd $(Agent.BuildDirectory)/ansible-role-apache
    molecule test
  displayName: Test relevant platforms